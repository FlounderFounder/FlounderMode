<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Floundermode Dictionary</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      body {
        font-family: "Roboto Mono", monospace;
        background-color: #f5f5f5;
        color: #1a1a1a;
        margin: 0;
        padding: 0;
        line-height: 1.6;
        overflow-x: hidden;
      }

      .main-header {
        background: #fff;
        border-bottom: 4px solid #000;
        box-shadow: 0 4px 0 #000;
        margin-bottom: 2rem;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .page-title {
        font-family: "Bebas Neue", sans-serif;
        font-size: clamp(1.5rem, 4vw, 2.5rem);
        margin: 0;
        letter-spacing: 2px;
        color: #1a1a1a;
      }

      .header-nav {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      .nav-button {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
        font-weight: bold;
        border: 2px solid #000;
        background: #fff;
        box-shadow: 2px 2px 0 #000;
        cursor: pointer;
        transition: transform 0.2s ease, background-color 0.2s ease;
        text-transform: uppercase;
        font-family: "Roboto Mono", monospace;
      }

      .nav-button:hover {
        background-color: #ffe680;
        transform: translateY(-1px);
      }

      .nav-button:active {
        transform: translateY(0);
        box-shadow: 1px 1px 0 #000;
      }

      .main-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
      }

      @media (max-width: 768px) {
        .header-content {
          flex-direction: column;
          text-align: center;
        }

        .page-title {
          font-size: clamp(1.2rem, 5vw, 2rem);
        }

        .header-nav {
          justify-content: center;
        }

        .nav-button {
          font-size: 0.8rem;
          padding: 0.4rem 0.8rem;
        }
      }

      .search-container {
        max-width: 800px;
        margin: 0 auto 2rem auto;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .search-wrapper {
        position: relative;
        flex: 1 1 60%;
        min-width: 200px;
      }

      .search-input {
        width: 100%;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        border: 2px solid #000;
        box-shadow: 3px 3px 0 #000;
      }

      .random-button {
        flex: 0 0 auto;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        font-weight: bold;
        border: 2px solid #000;
        background: #fff;
        box-shadow: 3px 3px 0 #000;
        cursor: pointer;
        transition: transform 0.2s ease, background-color 0.2s ease;
      }

      .random-button:hover {
        background-color: #ffe680;
        transform: translateY(-2px);
      }

      .autocomplete-list {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background: #fff;
        border: 2px solid #000;
        z-index: 10;
        box-shadow: 3px 3px 0 #000;
      }

      .autocomplete-list.hidden {
        display: none;
      }

      .autocomplete-item {
        padding: 0.5rem 1rem;
        cursor: pointer;
      }

      .autocomplete-item:hover {
        background: #ffd166;
      }

      .carousel {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 4rem;
      }

      .carousel button {
        flex: 0 0 auto;
        padding: 0.5rem 1rem;
        border: 2px solid #000;
        background: #fff;
        font-weight: bold;
        box-shadow: 3px 3px 0 #000;
        cursor: pointer;
        transition: transform 0.2s ease, background-color 0.2s ease;
      }

      .carousel button:hover {
        background-color: #ffe680;
        transform: translateY(-2px);
      }

      .term-modal {
        position: fixed;
        top: 50%;
        left: 50%;
        width: 90vw;
        max-width: 500px;
        max-height: 90vh;
        background: white;
        border: 2px solid black;
        box-shadow: 6px 6px 0 #000;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.95);
        pointer-events: none;
        transition: opacity 0.3s ease, transform 0.3s ease;
      }

      .term-modal .window-bar {
        background: #222;
        color: #fff;
        padding: 0.5rem 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
      }

      .term-modal .window-button {
        background: #ff4d4d;
        color: #000;
        border: 1px solid #000;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.2s ease, transform 0.2s ease;
      }

      .term-modal .window-button:hover {
        background-color: #ff1a1a;
        transform: scale(1.1);
      }

      .term-modal .term-content {
        padding: 1rem 1.25rem;
        overflow-y: auto;
      }

      .badge {
        display: inline-block;
        margin: 0.25rem 0.5rem 0.25rem 0;
        vertical-align: top;
        max-width: 100%;
        word-wrap: break-word;
        white-space: normal;
        background: #e0e0e0;
        padding: 0.2rem 0.6rem;
        font-size: 0.75rem;
        font-weight: bold;
        border: 2px solid #000;
        box-shadow: 2px 2px 0 #000;
        text-transform: uppercase;
        transition: background-color 0.2s ease, transform 0.2s ease;
      }

      .badge:hover {
        background-color: #d4d4d4;
        transform: scale(1.05);
      }

      @media (max-width: 500px) {
        .term-modal {
          width: 95vw;
          max-height: 95dvh;
        }
      }

      .term-modal.show {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
        pointer-events: auto;
      }

      .term-modal.hide {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.95);
        pointer-events: none;
      }

      .speech-bubble {
        position: absolute;
        background: no-repeat url("/assets/chat_bubble.svg");
        height: 400px;
        width: 351px;
        top: -15rem;
        padding: 3rem;
        padding-bottom: 3rem;
        padding-bottom: 233px;
        opacity: 1;
        transition: opacity 0.25s ease;
      }

      .wotd-container {
        position: fixed;
        bottom: -0.5rem;
        left: -0.25rem;
        transition: bottom 0.25s ease;
      }

      .wotd-container img {
        height: 25rem;
      }

      .wotd-container.hide {
        bottom: -234px;
      }

      .wotd-container.hide .speech-bubble {
        opacity: 0;
      }

      /* @media screen and (max-width: 764px) {
        
      } */
    </style>
  </head>
  <body>
    <header class="main-header">
      <div class="header-content">
        <h1 class="page-title">Floundermode Dictionary</h1>
        <nav class="header-nav">
          <button class="nav-button" onclick="showAbout()">About</button>
          <button class="nav-button" onclick="showContributing()">
            Contribute
          </button>
        </nav>
      </div>
    </header>

    <main class="main-content">
      <div class="search-container">
        <div class="search-wrapper">
          <input
            type="text"
            class="search-input"
            id="searchInput"
            placeholder="Search a term..."
          />
          <div class="autocomplete-list hidden" id="autocompleteList"></div>
        </div>
        <button class="random-button" onclick="selectRandomTerm()">
          Random
        </button>
      </div>

      <div class="carousel" id="carousel"></div>
    </main>

    <div class="wotd-container" onclick="toggleWotd()">
      <img src="/assets/carter-wynn.png" />
      <div class="speech-bubble">
        <strong>The word of the day:</strong>
        The word definition would go here. If it's long it might not fit. It's
        important that this text wraps.
      </div>
    </div>

    <div class="term-modal hide" id="termModal">
      <div class="window-bar">
        <span id="modalTitle"></span>
        <button class="window-button" onclick="closeModal()">âœ•</button>
      </div>
      <div class="term-content" id="modalContent"></div>
    </div>

    <script>
      async function init() {
        const searchInput = document.getElementById("searchInput");
        const autocompleteList = document.getElementById("autocompleteList");
        const carousel = document.getElementById("carousel");
        const termModal = document.getElementById("termModal");
        const modalTitle = document.getElementById("modalTitle");
        const modalContent = document.getElementById("modalContent");
        const wotdContainer = document.querySelector(".wotd-container");

        const fetchResult = await fetch("/terms/terms.json");
        const flounderTerms = await fetchResult.json();

        searchInput.addEventListener("input", () => {
          const value = searchInput.value.toLowerCase();
          autocompleteList.innerHTML = "";
          wotdContainer.classList.add("hide");

          if (!value) {
            autocompleteList.classList.add("hidden");
            wotdContainer.classList.remove("hide");
            return;
          }

          const matches = flounderTerms.filter((term) =>
            term.term.toLowerCase().includes(value)
          );

          if (matches.length == 0) {
            autocompleteList.classList.add("hidden");
            return;
          }

          autocompleteList.classList.remove("hidden");
          matches.forEach((match) => {
            const item = document.createElement("div");
            item.className = "autocomplete-item";
            item.textContent = match.term;
            item.onclick = () => {
              searchInput.value = "";
              autocompleteList.innerHTML = "";
              autocompleteList.classList.add("hidden");
              openModal(match);
            };
            autocompleteList.appendChild(item);
          });
        });

        function openModal(term) {
          modalTitle.textContent = term.term;

          const relatedTerms = term.related
            .map((tag) => `<span class='badge'>${tag}</span>`)
            .join(" ");

          const relatedSection =
            term.related.length == 0
              ? ``
              : `<p>
                  <strong>Related to:</strong> ${relatedTerms}
                </p>`;

          const newContent = `
            <p>
              <strong>Definition:</strong> ${term.definition}
              </p>

                <p><strong>Example:</strong> ${term.usage}</p>

                ${relatedSection}`;

          modalContent.innerHTML = newContent;
          termModal.classList.remove("hide");
          termModal.classList.add("show");
        }

        window.closeModal = function () {
          termModal.classList.remove("show");
          termModal.classList.add("hide");
        };

        function populateCarousel() {
          const shuffled = [...flounderTerms].sort(() => 0.5 - Math.random());
          shuffled.forEach((term) => {
            const btn = document.createElement("button");
            btn.textContent = term.term;
            btn.onclick = () => openModal(term);
            carousel.appendChild(btn);
          });
        }

        function getWotd() {
          // Get UTC midnight timestamp for today
          const now = new Date();
          const utcMidnight = new Date(
            Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate())
          );
          const daysSinceEpoch = Math.floor(
            utcMidnight.getTime() / (1000 * 60 * 60 * 24)
          );

          // Simple hash function to distribute selection
          let hash = daysSinceEpoch;
          hash = ((hash >>> 16) ^ hash) * 0x45d9f3b;
          hash = ((hash >>> 16) ^ hash) * 0x45d9f3b;
          hash = (hash >>> 16) ^ hash;

          return flounderTerms[Math.abs(hash) % flounderTerms.length];
        }

        function populateWotd() {
          const wotd = getWotd();
          const speechBubble = document.querySelector(".speech-bubble");
          speechBubble.innerHTML = `
            <strong>${wotd.term}</strong> ${wotd.definition}
          `;
        }

        window.selectRandomTerm = function () {
          const randomIndex = Math.floor(Math.random() * flounderTerms.length);
          const term = flounderTerms[randomIndex];
          openModal(term);
        };

        // Navigation functions
        window.scrollToTop = function () {
          window.scrollTo({ top: 0, behavior: "smooth" });
        };

        window.showAbout = function () {
          const aboutModal = {
            term: "About Floundermode Dictionary",
            definition:
              "A comprehensive dictionary of internet slang, memes, and digital culture terminology. Floundermode captures the evolving language of online communities.",
            usage:
              "Navigate through terms using the search bar, browse randomly, or click through the carousel below.",
            related: [],
          };
          openModal(aboutModal);
        };

        window.showContributing = function () {
          const contributingModal = {
            term: "Contributing to Floundermode",
            definition:
              "Help expand the dictionary by submitting new terms, definitions, and examples. All contributions are reviewed for accuracy and relevance.",
            usage:
              "Check the CONTRIBUTING.md file in the repository for detailed guidelines on how to add new terms and improve existing definitions.",
            related: [],
          };
          openModal(contributingModal);
        };

        window.toggleWotd = function () {
          const wotdContainer = document.querySelector(".wotd-container");
          wotdContainer.classList.toggle("hide");
        };

        populateCarousel();
        populateWotd();
      }

      init();
    </script>
  </body>
</html>
